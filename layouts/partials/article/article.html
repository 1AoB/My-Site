<article class="{{ if .Params.image }}has-image {{ end }}main-article">
    {{ partial "article/components/header" . }}

    {{ partial "article/components/content" . }}

    {{ partial "article/components/footer" . }}
    
    {{ if or .Params.math .Site.Params.article.math }}
        {{ partialCached "article/components/math.html" . }}
    {{ end }}
</article>

<div class="github-comments">
    <h3>Comments</h3>
    <div id="comments-list">
        <!-- GitHub comments will be injected here -->
    </div>
    <h4>Leave a comment</h4>
    <form id="comment-form">
        <textarea id="comment-content" placeholder="Write your comment..." required></textarea>
        <button type="submit">Post Comment</button>
    </form>
</div>

<script>
    // Replace with your GitHub username and repo name
    const username = "yourusername";
    const repo = "yourrepo";
    const issueNumber = "{{ .File.BaseFileName }}"; // Use file name or another unique identifier

    const apiUrl = `https://api.github.com/repos/${username}/${repo}/issues/${issueNumber}/comments`;

    // Fetch and display existing comments
    fetch(apiUrl)
        .then(response => response.json())
        .then(comments => {
            const commentsList = document.getElementById("comments-list");
            comments.forEach(comment => {
                const commentElement = document.createElement("div");
                commentElement.classList.add("comment");
                commentElement.innerHTML = `
                    <p><strong>${comment.user.login}</strong> commented:</p>
                    <p>${comment.body}</p>
                `;
                commentsList.appendChild(commentElement);
            });
        })
        .catch(error => console.error("Error fetching comments:", error));

    // Handle form submission
    document.getElementById("comment-form").addEventListener("submit", function(event) {
        event.preventDefault();
        const commentContent = document.getElementById("comment-content").value;

        // GitHub API requires authentication for posting comments
        fetch(apiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "token YOUR_GITHUB_PERSONAL_ACCESS_TOKEN" // Replace with your token
            },
            body: JSON.stringify({ body: commentContent })
        })
        .then(response => response.json())
        .then(newComment => {
            // Append the new comment to the list
            const commentsList = document.getElementById("comments-list");
            const commentElement = document.createElement("div");
            commentElement.classList.add("comment");
            commentElement.innerHTML = `
                <p><strong>${newComment.user.login}</strong> commented:</p>
                <p>${newComment.body}</p>
            `;
            commentsList.appendChild(commentElement);

            // Clear the form
            document.getElementById("comment-content").value = "";
        })
        .catch(error => console.error("Error posting comment:", error));
    });
</script>
